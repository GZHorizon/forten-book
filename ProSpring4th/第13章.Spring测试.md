# Spring测试

当开发企业级的应用程序时，测试是确保已完工的应用程序能如期待的一样执行并满足各种各样的需求（架构、安全、用户需求等）的重要步骤。在每次改变后，你应该确保修改不影响现有的逻辑。维护一个不断构建和测试的环境对于保证软件的质量是至关重要的。覆盖你所有代码的可复用的高覆盖率测试可以为你部署新的应用程序或修改应用程序提供高度的信心。

在企业开发环境中，应用程序中的每一层都会有各种各样的测试，每一种测试都有自己的特点和需求。在本章中我们讨论各种应用程序层次所涉及的测试的基本概念，特别是在基于Spring构建起来的应用程序下的测试。我们还会讨论如何使用Spring让各层的测试用例实现起来更简单的方法。特别的，本章涵盖以下主题：

- 企业测试框架：我们简要描述一个企业测试框架。我们会讨论各种测试以及它们的目标。针对各种应用程序层次，我们关注单元测试。
- 逻辑单元测试：最好的单元测试是只测试类中的一个方法的逻辑，所有被依赖的其它部分都以“虚拟”的形式提供正确的功能。本章中会讨论对于Spring MVC控制器类的逻辑单元测试的实现，在一个Java模拟库的帮助下执行类的依赖对象的“模拟”。
- 集成单元测试：在一个企业测试框架内，集成测试是指为一个特定块的业务逻辑测试一组不同应用程序层次上的类的交互。通常在一个集成测试环境中服务层应该连同持久层和后端可用的数据库进行测试。然而随着应用程序架构的发进化和轻量级内存数据库的成熟，目前的常见做法是把服务层与持久层和数据库作为一个整体来进行单元测试。例如本章里，我们使用JPA2、Hibernate、Spring Data JPA作为持久化提供者，使用H2作为数据库。在这个系统结构中，测试服务层时不关注Hibernate和Spring Data JPA的“模拟”。作为结果，本章我们讨论对服务层与持久层和H2内存数据库一起进行测试。这种测试通常被称为集成单元测试，位于单元测试与全面集成测试之间。
- 前端单元测试：虽然我们测试应用程序的每个层，但当应用程序被部署后我们仍然需要确保整个应用程序按预期运行。具体说，对于一个Web应用程序，部署后会不断的构建环境，我们需要运行前端测试来保证用户界面工作的正常。例如，对于联系人的应用程序，我们要确保正常功能的每一个步骤都可以正常工作，同时还应该测试异常情况（例如当信息没有通过校验阶段时，应用程序的功能应该如何）。本章中会简要讨论一个前端测试框架。

## 企业级测试框架简介

企业级测试框架是指在整个应用程序生命周期中的测试活动。在不同的阶段，为了验证应用程序的功能是否能按预期的业务和技术需求工作，不同的测试活动会被执行。

在每一个阶段会执行不同的测试用例。其中一些可以自动运行，而另一些需要手动运行。每个用例的结果被相关人员进行验证（例如业务分析师、应用程序用户等）。

表13-1描述了每种测试类型的特点和目标，以及常用工具和用于实现测试用例的库。